# Deploying to Render - Step-by-Step Guide

This guide will walk you through deploying your Django e-commerce project to Render.

## Prerequisites

- ‚úÖ GitHub account with your project repository pushed
- ‚úÖ Render account (sign up at https://render.com)
- ‚úÖ MercadoPago API credentials

## Deployment Steps

### Option 1: Using Render Blueprint (Recommended)

The project includes a `render.yaml` file for automated deployment.

1. **Push your code to GitHub**:
   ```bash
   git add .
   git commit -m "Prepare for Render deployment"
   git push origin main
   ```

2. **Go to Render Dashboard**:
   - Visit https://dashboard.render.com
   - Click **"New +"** ‚Üí **"Blueprint"**

3. **Connect Repository**:
   - Select your GitHub repository
   - Render will automatically detect `render.yaml`

4. **Configure Environment Variables**:
   Render will prompt you to set these variables:
   
   - `ALLOWED_HOSTS`: Your Render URL (e.g., `your-app-name.onrender.com`)
   - `MERCADOPAGO_PUBLIC_KEY`: Your MercadoPago public key
   - `MERCADOPAGO_ACCESS_TOKEN`: Your MercadoPago access token
   
   Note: `SECRET_KEY` will be auto-generated by Render

5. **Deploy**:
   - Click **"Apply"**
   - Render will build and deploy your application
   - Wait for the build to complete (5-10 minutes)

---

### Option 2: Manual Setup

If you prefer manual setup:

1. **Create New Web Service**:
   - Go to https://dashboard.render.com
   - Click **"New +"** ‚Üí **"Web Service"**

2. **Connect Repository**:
   - Connect your GitHub account
   - Select your repository
   - Click **"Connect"**

3. **Configure Service**:
   - **Name**: `ecommerce-django` (or your preferred name)
   - **Region**: Choose closest to your users
   - **Branch**: `main`
   - **Runtime**: `Python 3`
   - **Build Command**:
     ```bash
     pip install -r requirements.txt && python manage.py collectstatic --noinput && python manage.py migrate
     ```
   - **Start Command**:
     ```bash
     gunicorn config.wsgi:application
     ```

4. **Set Environment Variables**:
   Click **"Advanced"** ‚Üí **"Add Environment Variable"** and add:
   
   | Key | Value |
   |-----|-------|
   | `SECRET_KEY` | Generate using: `python3 -c "from django.core.management.utils import get_random_secret_key; print(get_random_secret_key())"` |
   | `DEBUG` | `False` |
   | `ALLOWED_HOSTS` | Your Render URL (will be shown after creation, e.g., `your-app-name.onrender.com`) |
   | `MERCADOPAGO_PUBLIC_KEY` | Your MercadoPago public key |
   | `MERCADOPAGO_ACCESS_TOKEN` | Your MercadoPago access token |
   | `PYTHON_VERSION` | `3.11.0` |

5. **Create Web Service**:
   - Click **"Create Web Service"**
   - Render will start building your application

---

## Post-Deployment Steps

### 1. Update ALLOWED_HOSTS

After deployment, you'll get a URL like `https://your-app-name.onrender.com`

Update the `ALLOWED_HOSTS` environment variable:
- Go to your service ‚Üí **"Environment"**
- Update `ALLOWED_HOSTS` to: `your-app-name.onrender.com`
- Save changes (this will trigger a redeploy)

### 2. Create Superuser

Once deployed, create an admin user:

1. Go to your service in Render dashboard
2. Click **"Shell"** tab
3. Run:
   ```bash
   python manage.py createsuperuser
   ```
4. Follow the prompts to create your admin account

### 3. Load Initial Data (Optional)

If you have a `populate_db` command:
```bash
python manage.py populate_db
```

### 4. Verify Deployment

Test these endpoints:
- **Homepage**: `https://your-app-name.onrender.com/`
- **Health Check**: `https://your-app-name.onrender.com/health/`
- **Admin Panel**: `https://your-app-name.onrender.com/admin/`
- **Custom Admin**: `https://your-app-name.onrender.com/custom-admin/`

---

## Important Notes

### Free Tier Limitations

Render's free tier has some limitations:
- ‚ö†Ô∏è **Spin down after inactivity**: Services sleep after 15 minutes of inactivity
- ‚ö†Ô∏è **Cold starts**: First request after sleep takes 30-60 seconds
- ‚ö†Ô∏è **750 hours/month**: Free tier limit
- ‚úÖ **Automatic HTTPS**: Free SSL certificates included

### Database

The project uses SQLite by default, which works on Render but has limitations:
- ‚ö†Ô∏è SQLite data persists on Render's free tier
- ‚ö†Ô∏è For production, consider upgrading to PostgreSQL

To add PostgreSQL:
1. Create a PostgreSQL database in Render
2. Install PostgreSQL dependencies:
   ```bash
   pip install -r requirements-postgres.txt
   ```
3. Add `DATABASE_URL` environment variable (Render provides this automatically)

### Static Files

Static files are handled by Whitenoise, so they work automatically on Render. No additional configuration needed!

---

## Monitoring and Logs

### View Logs
- Go to your service in Render dashboard
- Click **"Logs"** tab
- View real-time application logs

### Health Check
Monitor your application at: `https://your-app-name.onrender.com/health/`

Returns:
```json
{
  "status": "healthy",
  "debug": false
}
```

---

## Troubleshooting

### Build Fails

**Check build logs** in Render dashboard:
- Ensure all dependencies in `requirements.txt` are compatible
- Verify Python version matches `runtime.txt`

### Application Won't Start

1. **Check environment variables** are set correctly
2. **View logs** for error messages
3. **Verify ALLOWED_HOSTS** includes your Render URL

### Static Files Not Loading

1. Ensure `collectstatic` runs in build command
2. Check that whitenoise is in `MIDDLEWARE` (already configured)
3. Verify `STATIC_ROOT` is set (already configured)

### Database Errors

1. Check that migrations ran successfully in build logs
2. Run migrations manually via Shell if needed:
   ```bash
   python manage.py migrate
   ```

### 500 Internal Server Error

1. **Check logs** in Render dashboard
2. Verify all environment variables are set
3. Ensure `DEBUG=False` and `ALLOWED_HOSTS` is configured
4. Check that `SECRET_KEY` is set

---

## Custom Domain (Optional)

To use your own domain:

1. Go to your service ‚Üí **"Settings"**
2. Scroll to **"Custom Domain"**
3. Click **"Add Custom Domain"**
4. Follow instructions to configure DNS
5. Update `ALLOWED_HOSTS` to include your custom domain

---

## Updating Your Application

Render automatically redeploys when you push to your connected branch:

```bash
git add .
git commit -m "Update application"
git push origin main
```

Render will:
1. Pull latest code
2. Run build command
3. Run migrations
4. Collect static files
5. Restart the service

---

## Environment Variables Reference

| Variable | Required | Description | Example |
|----------|----------|-------------|---------|
| `SECRET_KEY` | ‚úÖ Yes | Django secret key | Auto-generated or custom |
| `DEBUG` | ‚úÖ Yes | Debug mode | `False` |
| `ALLOWED_HOSTS` | ‚úÖ Yes | Allowed hostnames | `your-app.onrender.com` |
| `MERCADOPAGO_PUBLIC_KEY` | ‚úÖ Yes | MercadoPago public key | Your key |
| `MERCADOPAGO_ACCESS_TOKEN` | ‚úÖ Yes | MercadoPago access token | Your token |
| `PYTHON_VERSION` | No | Python version | `3.11.0` |
| `DJANGO_LOG_LEVEL` | No | Logging level | `INFO` |
| `DATABASE_URL` | No | PostgreSQL URL | Auto-set if using Render PostgreSQL |

---

## Cost Optimization

### Free Tier Tips
- Use the free tier for development/testing
- Upgrade to paid tier for production ($7/month for always-on)
- Consider upgrading to PostgreSQL for better performance

### Paid Tier Benefits
- No spin down (always available)
- Better performance
- More resources
- Priority support

---

## Next Steps

1. ‚úÖ Deploy to Render using steps above
2. ‚úÖ Create superuser account
3. ‚úÖ Test all functionality
4. ‚úÖ Configure custom domain (optional)
5. ‚úÖ Set up monitoring
6. ‚úÖ Consider upgrading to PostgreSQL for production

---

## Support

- **Render Documentation**: https://render.com/docs
- **Render Community**: https://community.render.com
- **Django Documentation**: https://docs.djangoproject.com/

---

## Quick Reference Commands

Generate SECRET_KEY:
```bash
python3 -c "from django.core.management.utils import get_random_secret_key; print(get_random_secret_key())"
```

Access Render Shell:
```bash
# Via Render Dashboard ‚Üí Shell tab
python manage.py createsuperuser
python manage.py migrate
python manage.py populate_db
```

View Logs:
```bash
# Via Render Dashboard ‚Üí Logs tab
```

---

**Your application is ready to deploy to Render! üöÄ**

Follow the steps above and your e-commerce site will be live in minutes.
