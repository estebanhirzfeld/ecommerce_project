sequenceDiagram
    participant User
    participant View
    participant Cart
    participant CouponSystem
    participant Database

    Note over User, Database: Aplicar CupÃ³n
    User->>View: POST /coupons/apply/
    View->>Database: Coupon.objects.get(code=code)
    alt Valid Coupon
        Database-->>View: Coupon Instance
        View->>Cart: cart.coupon = coupon
        Cart-->>View: Updated Total
        View-->>User: Success Message
    else Invalid Coupon
        Database-->>View: None
        View-->>User: Error Message
    end

    Note over User, Database: Realizar Compra
    User->>View: POST /orders/create/
    View->>Cart: Get Cart Items & Coupon
    View->>Database: Order.objects.create()
    loop For each item in Cart
        View->>Database: OrderItem.objects.create()
    end
    View->>Cart: cart.clear()
    View-->>User: Redirect to Payment

    Note over User, Database: Dejar Review
    User->>View: POST /store/product/{id}/review/
    View->>Database: Review.objects.create()
    Database-->>View: Review Saved
    View-->>User: Show Review on Product Page
